<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
	<title>NPTG-Viewer</title>

	<link rel="icon" type="image/png" href="site-icon.png">

	<link rel="stylesheet" href="base.css" type="text/css">
	<link rel="stylesheet" href="viewer-layout.css" type="text/css">

	<script src="scripts/prototype.js" type="text/javascript"></script>
	<script src="scripts/OpenLayers.js" type="text/javascript"></script>
	<script src="scripts/OpenStreetMap.js" type="text/javascript"></script>
	<script src="scripts/NaptanMerger.js" type="text/javascript"></script>
	<script type="text/javascript">

		var mapControl = null;
		var stopViewer = null;
		var matchList = null;
		var duplicateList = null;

		var currentStop = null;

		runApp(function () {
			var stopPanel = new NaptanMerger.WidgetContainer('stopPanel');
			var matchPanel = new NaptanMerger.WidgetContainer('matchPanel');
			var duplicatePanel = new NaptanMerger.WidgetContainer('duplicatePanel');

			mapControl = new NaptanMerger.MapControl('map');
			stopViewer = new NaptanMerger.StopViewer();
			matchList = new NaptanMerger.LocalityList(mapControl, 'Matching Localities');
			duplicateList = new NaptanMerger.LocalityList(mapControl, 'Duplicate Localities');
			
			stopPanel.embedWidget(stopViewer);
			matchPanel.embedWidget(matchList);
			duplicatePanel.embedWidget(duplicateList);

			mapControl.events.register("stop_click", this, function (evt) {
				if (currentStop) {
					mapControl.unselectFeature(currentStop);
				}

				mapControl.selectFeature(evt.feature);
				stopViewer.setStop(evt.feature);
				matchList.getLocalities('localities?matches_with='+evt.feature.attributes.id);
				duplicateList.getLocalities('localities?duplicates_of='+evt.feature.attributes.id);
				currentStop = evt.feature;
			});

			mapControl.events.register("stop_mouseover", this, function(evt) {
				mapControl.highlightFeature(evt.feature);
				matchList.highlightLocality(evt.feature);
				duplicateList.highlightLocality(evt.feature);
				stopViewer.setStop(evt.feature);
			});

			mapControl.events.register("stop_mouseout", this, function(evt) {
				mapControl.unhighlightFeature(evt.feature);
				matchList.unhighlightLocality(evt.feature);
				duplicateList.unhighlightLocality(evt.feature);
				stopViewer.setStop(currentStop);
			});

			matchList.events.register('mouseover', this, function(evt) {
				matchList.highlightLocality(evt.feature);
				mapControl.highlightFeature(evt.feature);
				stopViewer.setStop(evt.feature);
			});

			matchList.events.register('mouseout', this, function(evt) {
				matchList.unhighlightLocality(evt.feature);
				mapControl.unhighlightFeature(evt.feature);
				stopViewer.setStop(currentStop);
			});

			matchList.events.register('click', this, function(evt) {
				if (currentStop) {
					mapControl.unselectFeature(currentStop);
				}

				mapControl.unhighlightFeature(evt.feature);
				mapControl.selectFeature(evt.feature);
				stopViewer.setStop(evt.feature);
				matchList.getLocalities('localities?matches_with='+evt.feature.attributes.id);
				duplicateList.getLocalities('localities?duplicates_of='+evt.feature.attributes.id);
				currentStop = evt.feature;
			});

			duplicateList.events.register('mouseover', this, function(evt) {
				duplicateList.highlightLocality(evt.feature);
				mapControl.highlightFeature(evt.feature);
				stopViewer.setStop(evt.feature);
			});

			duplicateList.events.register('mouseout', this, function(evt) {
				duplicateList.unhighlightLocality(evt.feature);
				mapControl.unhighlightFeature(evt.feature);
				stopViewer.setStop(currentStop);
			});

			duplicateList.events.register('click', this, function(evt) {
				if (currentStop) {
					mapControl.unselectFeature(currentStop);
				}

				mapControl.unhighlightFeature(evt.feature);
				mapControl.selectFeature(evt.feature);
				stopViewer.setStop(evt.feature);
				matchList.getLocalities('localities?matches_with='+evt.feature.attributes.id);
				duplicateList.getLocalities('localities?duplicates_of='+evt.feature.attributes.id);
				currentStop = evt.feature;
			});
		});

	</script>
</head>

<body>
	<h1><img src="logo.png" alt="NOVAM-Logo">NPTG-Viewer</h1>
	<ul id="tools_menu">
		<li><a href="">Help</a></li>
	</ul>
	<div id="map"></div>
	<div id="stopPanel"></div>
	<div id="matchPanel"></div>
	<div id="duplicatePanel"></div>
	<div id="mapKey">
		<h2>Map Key</h2>
		<dl>
			<dt><img src="plain_nptg_locality.png" alt="Blue marker"></dt>
			<dd>Locality from the NPTG dataset with no counterpart in OSM</dd>
			<dt><img src="plain_osm_locality.png" alt="Yellwo marker"></dt>
			<dd>Locality from OpenStreetMap with no matching locality in NPTG</dd>
			<dt><img src="matched_nptg_locality.png" alt="Grey marker"></dt>
			<dd>Locality from NPTG which has been matched with a OSM locality</dd>
			<dt><img src="matched_osm_locality.png" alt="Green marker"></dt>
			<dd>Locality from OpenStreetMap which as been match with NPTG locality</dd>
		</dl>
	</div>
</body>
</html>
